<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Robotic Invasion</title>
    <script type="text/javascript" src="phaser/build/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>

<body>
    <script type="text/javascript">
        var game = new Phaser.Game(1000, 600, Phaser.AUTO, '', {
            preload: preload
            , create: create
            , update: update
        });

        function preload() {
            game.load.image('bullet', 'assets/playerBullet.png', 13, 5);
            game.load.spritesheet('spaceman', 'assets/spaceSoldier.png', 51, 51);
            game.load.image('space', 'assets/background.jpg');
        }
        var player;
        var space;
        var controls;
        var controlJump;
        var bullets
        var fireRate = 250;
        var nextFire = 0;
        var playerLookRight = true;

        function create() {
            game.physics.startSystem(Phaser.Physics.ARCADE);
            game.add.sprite(0, 0, 'space');
            player = game.add.sprite(32, game.world.height - 150, 'spaceman');
            player.animations.add('fallRight', [4], 8, true);
            player.animations.add('fallLeft', [5], 8, true);
            player.animations.add('right', [10, 11, 12, 13, 14, 15, 16, 17], 8, true);
            player.animations.add('left', [20, 21, 22, 23, 24, 25, 26, 27], 8, true);
            cursors = game.input.keyboard.createCursorKeys();
            controlJump = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
            game.input.keyboard.addKeyCapture([Phaser.Keyboard.C]);
            game.physics.arcade.enable(player);
            player.body.bounce.y = 0.2;
            player.body.gravity.y = 300;
            player.body.collideWorldBounds = true;
            player.anchor.set(0.5);
            bullets = game.add.group();
            bullets.enableBody = true;
            bullets.physicsBodyType = Phaser.Physics.ARCADE;
            bullets.createMultiple(50, 'bullet');
            bullets.setAll('checkWorldBounds', true);
            bullets.setAll('outOfBoundsKill', true);
        }

        function update() {
            if (cursors.right.isDown) {
                player.body.velocity.x = 300;
                player.animations.play('right');
                playerLookRight = true;
            }
            else if (cursors.left.isDown) {
                player.body.velocity.x = -300;
                player.animations.play('left');
                playerLookRight = false;
            }
            else {
                player.animations.stop();
                player.body.velocity.x = 0;
                if (playerLookRight == false) {
                    player.frame = 1;
                }
                else {
                    player.frame = 0;
                }
            }
            if (controlJump.isDown) {
                if (player.body.velocity.y == -0.8333333333333335 || player.body.velocity.y == -0.8333333333333334) {
                    if (cursors.right.isDown && controlJump.isDown) {
                        player.body.velocity.y = -300;
                        player.body.velocity.x = 300;
                        player.animations.play('fallRight');
                    }
                    else if (cursors.left.isDown && controlJump.isDown) {
                        player.body.velocity.y = -300;
                        player.body.velocity.x = -300;
                        player.animations.play('fallLeft');
                    }
                    else {
                        player.body.velocity.y = -300;
                        player.animations.play('fallRight');
                    }
                }
            }
            if (game.input.keyboard.isDown(Phaser.Keyboard.C)) {
                fireBullet();
            }
        }

        function fireBullet() {
            if (game.time.now > nextFire && bullets.countDead() > 0) {
                nextFire = game.time.now + fireRate;
                var bullet = bullets.getFirstDead();
                if (playerLookRight == false) {
                    bullet.reset(player.x - 20, player.y - 4);
                    bullet.body.velocity.x = -500;
                }
                else {
                    bullet.reset(player.x + 8, player.y - 4);
                    bullet.body.velocity.x = 500;
                }
            }
        }
    </script>
</body>

</html>